åœ¨å¼€å§‹æœ¬æ–‡ä¹‹å‰ç®€å•è¯´å‡ å¥ï¼Œæœ‰è¯»è€…ååº”åœ¨é¢è¯•é˜¿é‡Œæ—¶è¢«é—®äº†ç½‘å…³ç›¸å…³çš„å†…å®¹ï¼Œè¿™ä½è¯»è€…åˆšå¥½çœ‹åˆ°æœ¬äººä¹‹å‰å†™çš„ä¸¤ç¯‡ç½‘å…³çš„æ–‡ç« ï¼Œå¸®ä¸Šäº†å¿™ï¼Œå†æ¬¡æ¨èç»™å¤§å®¶ï¼Œç›¸ä¿¡å¤§å®¶çœ‹å®Œè‚¯å®šæœ‰æ”¶è·

[é«˜æ€§èƒ½æ¥å…¥å±‚ç½‘å…³è®¾è®¡å®è·µ](https://mp.weixin.qq.com/s/oAh5IojX_iz01nbf8mJMSQ)

[é«˜æ€§èƒ½ Java åº”ç”¨å±‚ç½‘å…³è®¾è®¡å®è·µ](https://mp.weixin.qq.com/s/k8dI6FU78JcgGUGOVTAt4w)

## å‰è¨€
æ—¥å¿—ä½œä¸ºæ’æŸ¥é—®é¢˜çš„é‡è¦æ‰‹æ®µï¼Œå¯ä»¥è¯´æ˜¯åº”ç”¨é›†æˆä¸­å¿…ä¸å¯å°‘çš„ä¸€ç¯ï¼Œä½†åœ¨æ—¥å¿—ä¸­ï¼Œåˆä¸å®œæš´éœ²åƒç”µè¯ï¼Œèº«ä»½è¯ï¼Œåœ°å€ç­‰ä¸ªäººæ•æ„Ÿä¿¡æ¯ï¼Œå»å¹´ Q4 æˆ‘å¸å°±å¼€å±•äº†å¯¹ ELK æ—¥å¿—è„±æ•çš„å…¨é¢è¦æ±‚ã€‚é‚£ä¹ˆæ€æ ·å¿«é€Ÿåˆæœ‰æ•ˆåœ°å®ç°æ—¥å¿—è„±æ•å‘¢ã€‚ç›¸ä¿¡è¯»è€…çœ‹å®Œæ ‡é¢˜å·²ç»çŒœåˆ°äº†ï¼Œæ²¡é”™ï¼Œç”¨æ³¨è§£ï¼é‚£ä¹ˆç”¨æ³¨è§£è¯¥æ€ä¹ˆå®ç°æ—¥å¿—è„±æ•å‘¢ï¼Œé™¤äº†æ—¥å¿—è„±æ•ï¼Œæ³¨è§£è¿˜èƒ½ç”¨åœ¨å“ªäº›åœºæ™¯å‘¢ï¼Œæ³¨è§£çš„å®ç°åŸç†åˆæ˜¯æ€æ ·çš„å‘¢ã€‚æœ¬æ–‡å°†ä¼šä¸ºä½ è¯¦ç»†ä»‹ç»ã€‚

æœ¬æ–‡å°†ä¼šä»ä»¥ä¸‹å‡ ä¸ªæ–¹é¢æ¥ä»‹ç»æ³¨è§£ã€‚

* æ—¥å¿—è„±æ•åœºæ™¯ç®€ä»‹
* å·§ç”¨æ³¨è§£è§£å†³è¿™ä¸¤ç±»é—®é¢˜
    1. æ³¨è§£çš„å®šä¹‰ä¸å®ç°åŸç†
    2. ä½¿ç”¨æ³¨è§£è§£å†³æ—¥å¿—è„±æ•
* æ³¨è§£é«˜çº§ç”¨æ³•-è§£å†³é“¶è¡Œä¸­å‚æ•°ä¼ é€’é¡ºåºè¦æ±‚

ç›¸ä¿¡å¤§å®¶çœ‹äº†è‚¯å®šæœ‰æ”¶è·ï¼

## æ—¥å¿—è„±æ•åœºæ™¯ç®€ä»‹

åœ¨æ—¥å¿—é‡Œæˆ‘ä»¬çš„æ—¥å¿—ä¸€èˆ¬æ‰“å°çš„æ˜¯ model çš„ Json stringï¼Œæ¯”å¦‚æœ‰ä»¥ä¸‹ model ç±»

```java
public class Request {
    /**
     *  ç”¨æˆ·å§“å
     */
    private String name;
    /**
     *  èº«ä»½è¯ 
     */
    private String idcard;
    /**
     *  æ‰‹æœºå·
     */
    private String phone;

    /**
     *  å›¾ç‰‡çš„ base64
     */
    private String imgBase64;
}
```
æœ‰ä»¥ä¸‹ç±»å®ä¾‹

```java
Request request = new Request();
request.setName("çˆ±æ–°è§‰ç½—");
request.setIdcard("450111112222");
request.setPhone("18611111767");
request.setImgBase64("xxx");
```

æˆ‘ä»¬ä¸€èˆ¬ä½¿ç”¨ fastJson æ¥æ‰“å°æ­¤ Request çš„ json stringï¼š

```java
log.info(JSON.toJSONString(request));
```
è¿™æ ·å°±èƒ½æŠŠ Request çš„æ‰€æœ‰å±æ€§å€¼ç»™æ‰“å°å‡ºæ¥ï¼Œæ—¥å¿—å¦‚ä¸‹:
```json
{"idcard":"450111112222","imgBase64":"xxx","name":"å¼ ä¸‰","phone":"17120227942"}
```

è¿™é‡Œçš„æ—¥å¿—æœ‰ä¸¤ä¸ªé—®é¢˜

1. å®‰å…¨æ€§: nameï¼Œphone, idcard è¿™äº›ä¸ªäººä¿¡æ¯æå…¶æ•æ„Ÿï¼Œä¸åº”ä»¥æ˜æ–‡çš„å½¢å¼æ‰“å°å‡ºæ¥ï¼Œæˆ‘ä»¬å¸Œæœ›è¿™äº›æ•æ„Ÿä¿¡æ¯æ˜¯ä»¥è„±æ•çš„å½¢å¼è¾“å‡ºçš„
2. å­—æ®µå†—ä½™ï¼šimgBase64 æ˜¯å›¾ç‰‡çš„ base64ï¼Œæ˜¯ä¸€ä¸²éå¸¸é•¿çš„å­—ç¬¦ä¸²ï¼Œåœ¨ç”Ÿäº§ä¸Šï¼Œå›¾ç‰‡ base64 æ•°æ®å¯¹æ’æŸ¥é—®é¢˜å¸®åŠ©ä¸å¤§ï¼Œåè€Œä¼šå¢å¤§å­˜å‚¨æˆæœ¬ï¼Œè€Œä¸”è¿™ä¸ªå­—æ®µæ˜¯èº«ä»½è¯æ­£åé¢çš„ base64ï¼Œä¹Ÿå±äºæ•æ„Ÿä¿¡æ¯ï¼Œæ‰€ä»¥è¿™ä¸ªå­—æ®µåœ¨æ—¥å¿—ä¸­éœ€è¦æŠŠå®ƒå»æ‰ã€‚æˆ‘ä»¬å¸Œæœ›ç»è¿‡è„±æ•å’Œç˜¦èº«ï¼ˆç§»é™¤ imgBase64 å­—æ®µï¼‰åçš„æ—¥å¿—å¦‚ä¸‹:

```json
{"idcard":"450******222","name":"çˆ±**ç½—","phone":"186****1767","imgBase64":""}
```
å¯ä»¥çœ‹åˆ°å„ä¸ªå­—æ®µæœ€åéƒ½è„±æ•äº†ï¼Œä¸è¿‡éœ€è¦æ³¨æ„çš„è¿™å‡ ä¸ªå­—æ®µçš„è„±æ•è§„åˆ™æ˜¯ä¸ä¸€æ ·çš„
* èº«ä»½è¯ï¼ˆidcardï¼‰ï¼Œä¿ç•™å‰ä¸‰ä½ï¼Œåä¸‰ä½ï¼Œå…¶ä½™æ‰“ç 
* å§“åï¼ˆnameï¼‰ä¿ç•™å‰åä¸¤ä½ï¼Œå…¶ä½™æ‰“ç 
* ç”µè¯å·ç ï¼ˆphoneï¼‰ä¿æŒå‰ä¸‰ä½ï¼Œåå››ä½ï¼Œå…¶ä½™æ‰“ç 
* å›¾ç‰‡çš„ base64ï¼ˆimgBase64ï¼‰ç›´æ¥å±•ç¤ºç©ºå­—ç¬¦ä¸²

è¯¥æ€ä¹ˆå®ç°å‘¢ï¼Œé¦–å…ˆæˆ‘ä»¬éœ€è¦çŸ¥é“ä¸€ä¸ªçŸ¥è¯†ç‚¹ï¼Œå³ JSON.toJSONString æ–¹æ³•æŒ‡å®šäº†ä¸€ä¸ªå‚æ•° ValueFilterï¼Œå¯ä»¥å®šåˆ¶è¦è½¬åŒ–çš„å±æ€§ã€‚æˆ‘ä»¬å¯ä»¥åˆ©ç”¨æ­¤ Filter è®©æœ€ç»ˆçš„ JSON string ä¸å±•ç¤ºæˆ–å±•ç¤ºè„±æ•åçš„ valueã€‚å¤§æ¦‚é€»è¾‘å¦‚ä¸‹

```java
public class Util {
    public static String toJSONString(Object object) {
        try {
            return JSON.toJSONString(object, getValueFilter());
        } catch (Exception e) {
            return ToStringBuilder.reflectionToString(object);
        }
    }
    
private static ValueFilter getValueFilter() {
        return (obj, key, value) -> {
            // obj-å¯¹è±¡ key-å­—æ®µå value-å­—æ®µå€¼
            return  æ ¼å¼åŒ–åçš„value
        };
}
```
å¦‚ä¸Šå›¾ç¤ºï¼Œæˆ‘ä»¬åªè¦åœ¨ **getValueFilter** æ–¹æ³•ä¸­å¯¹ value ä½œç›¸å…³çš„è„±æ•æ“ä½œï¼Œå³å¯åœ¨æœ€ç»ˆçš„æ—¥å¿—ä¸­å±•ç¤ºè„±æ•åçš„æ—¥å¿—ã€‚ç°åœ¨é—®é¢˜æ¥äº†ï¼Œè¯¥æ€ä¹ˆå¤„ç†å­—æ®µçš„è„±æ•é—®é¢˜ï¼Œæˆ‘ä»¬çŸ¥é“æœ‰äº›å­—æ®µéœ€è¦è„±æ•ï¼Œæœ‰äº›å­—æ®µä¸éœ€è¦è„±æ•ï¼Œæ‰€ä»¥æœ‰äººå¯èƒ½ä¼šæ ¹æ® key çš„åç§°æ¥åˆ¤æ–­æ˜¯å¦è„±æ•ï¼Œä»£ç å¦‚ä¸‹:

```java
private static ValueFilter getValueFilter() {
        return (obj, key, value) -> {
            // obj-å¯¹è±¡ key-å­—æ®µå value-å­—æ®µå€¼
            if (Objects.equal(key, "phone")) {
                return è„±æ•åçš„phone
            }
            if (Objects.equal(key, "idcard")) {
                return è„±æ•åçš„idcard
            }
            if (Objects.equal(key, "name")) {
                return è„±æ•åçš„name
            }
            // å…¶ä½™ä¸éœ€è¦è„±æ•çš„æŒ‰åŸå€¼è¿”å›
            return  value
        };
}
```
è¿™æ ·çœ‹èµ·æ¥ç¡®å®å®ç°äº†éœ€æ±‚ï¼Œä½†ä»…ä»…å®ç°äº†éœ€æ±‚å°±å¤Ÿäº†å—ï¼Œè¿™æ ·çš„å®ç°æœ‰ä¸ªæ¯”è¾ƒä¸¥é‡çš„é—®é¢˜ï¼š

**è„±æ•è§„åˆ™ä¸å…·ä½“çš„å±æ€§åç´§è—•åˆ**ï¼Œéœ€è¦åœ¨ valueFilter é‡Œå†™å¤§é‡çš„ if else åˆ¤æ–­é€»è¾‘ï¼Œå¯æ‰©å±•æ€§ä¸é«˜ï¼Œé€šç”¨æ€§ä¸å¼ºï¼Œä¸¾ä¸ªç®€å•çš„ä¾‹å­ï¼Œç”±äºä¸šåŠ¡åŸå› ï¼Œåœ¨æˆ‘ä»¬çš„å·¥ç¨‹ä¸­ç”µè¯æœ‰äº›å­—æ®µåå« phone, æœ‰äº›å« telï¼Œæœ‰äº›å« telephoneï¼Œå®ƒä»¬çš„è„±æ•è§„åˆ™æ˜¯ä¸€æ ·çš„ï¼Œä½†ä½ ä¸å¾—ä¸åœ¨ä¸Šé¢çš„æ–¹æ³•ä¸­å†™å‡ºå¦‚ä¸‹ä¸‘é™‹çš„ä»£ç ã€‚

```java
private static ValueFilter getValueFilter() {
        return (obj, key, value) -> {
            // obj-å¯¹è±¡ key-å­—æ®µå value-å­—æ®µå€¼
            if (Objects.equal(key, "phone") || Objects.equal(key, "tel") || Objects.equal(key, "telephone") || ) {
                return è„±æ•åçš„phone
            }

            // å…¶ä½™ä¸éœ€è¦è„±æ•çš„æŒ‰åŸå€¼è¿”å›
            return  value
        };
}
```

é‚£ä¹ˆèƒ½å¦ç”¨ä¸€ç§é€šç”¨çš„ï¼Œå¯æ‰©å±•æ€§å¥½çš„æ–¹æ³•æ¥è§£å†³å‘¢ï¼Œç›¸ä¿¡ä½ çœ‹åˆ°æ–‡ç« çš„æ ‡é¢˜å·²ç»å¿ƒä¸­æœ‰æ•°äº†ï¼Œæ²¡é”™ï¼Œå°±æ˜¯ç”¨çš„æ³¨è§£ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬æ¥çœ‹çœ‹ä»€ä¹ˆæ˜¯æ³¨è§£ä»¥åŠå¦‚ä½•è‡ªå®šä¹‰æ³¨è§£

## æ³¨è§£çš„å®šä¹‰ä¸å®ç°åŸç†

æ³¨è§£ï¼ˆAnnotationï¼‰åˆç§°  Java æ ‡æ³¨ï¼Œæ˜¯ JDK 5.0 å¼•å…¥çš„ä¸€ç§æ³¨é‡Šæœºåˆ¶ï¼Œå¦‚æœè¯´ä»£ç çš„æ³¨é‡Šæ˜¯ç»™ç¨‹åºå‘˜çœ‹çš„ï¼Œé‚£ä¹ˆæ³¨è§£å°±æ˜¯ç»™ç¨‹åºçœ‹çš„ï¼Œç¨‹åºçœ‹åˆ°æ³¨è§£åå°±å¯ä»¥åœ¨è¿è¡Œæ—¶æ‹¿åˆ°æ³¨è§£ï¼Œæ ¹æ®æ³¨è§£æ¥å¢å¼ºè¿è¡Œæ—¶çš„èƒ½åŠ›ï¼Œå¸¸è§çš„åº”ç”¨åœ¨ä»£ç ä¸­çš„æ³¨è§£æœ‰å¦‚ä¸‹ä¸‰ä¸ª

* @Override æ£€æŸ¥è¯¥æ–¹æ³•æ˜¯å¦é‡å†™äº†çˆ¶ç±»æ–¹æ³•ï¼Œå¦‚æœå‘ç°çˆ¶ç±»æˆ–å®ç°çš„æ¥å£ä¸­æ²¡æœ‰æ­¤æ–¹æ³•ï¼Œåˆ™æŠ¥ç¼–è¯‘é”™è¯¯
* @Deprecated æ ‡è®°è¿‡æ—¶çš„ç±»ï¼Œæ–¹æ³•ï¼Œå±æ€§ç­‰
* @SuppressWarnings - æŒ‡ç¤ºç¼–è¯‘å™¨å»å¿½ç•¥æ³¨è§£ä¸­å£°æ˜çš„è­¦å‘Šã€‚

é‚£è¿™äº›æ³¨è§£æ˜¯æ€ä¹ˆå®ç°çš„å‘¢ï¼Œæˆ‘ä»¬æ‰“å¼€ @Override è¿™ä¸ªæ³¨è§£çœ‹çœ‹

```java
@Documented
@Retention(RetentionPolicy.RUNTIME)
@Target(value={CONSTRUCTOR, FIELD, LOCAL_VARIABLE, METHOD, PACKAGE, PARAMETER, TYPE})
public @interface Deprecated {
}
```

å¯ä»¥çœ‹åˆ° Deprecated æ³¨è§£ä¸Šåˆæœ‰ @Documented, @Retention, @Target è¿™äº›æ³¨è§£ï¼Œè¿™äº›æ³¨è§£åˆå«å…ƒæ³¨è§£ï¼Œå³æ³¨è§£ Deprecated æˆ–å…¶ä»–è‡ªå®šä¹‰æ³¨è§£çš„æ³¨è§£ï¼Œå…¶ä»–æ³¨è§£çš„è¡Œä¸ºç”±è¿™äº›æ³¨è§£æ¥è§„èŒƒå’Œå®šä¹‰ï¼Œè¿™äº›å…ƒæ³¨è§£çš„ç±»å‹åŠä½œç”¨å¦‚ä¸‹

* @Documented è¡¨æ˜å®ƒä¼šè¢« javadoc ä¹‹ç±»çš„å·¥å…·å¤„ç†, è¿™æ ·æœ€ç»ˆæ³¨è§£ç±»å‹ä¿¡æ¯ä¹Ÿä¼šè¢«åŒ…æ‹¬åœ¨ç”Ÿæˆçš„æ–‡æ¡£ä¸­
* @Retention  æ³¨è§£çš„ä¿å­˜ç­–ç•¥ï¼Œä¸»è¦æœ‰ä»¥ä¸‹ä¸‰ç§
    * RetentionPolicy.SOURCE æºä»£ç çº§åˆ«çš„æ³¨è§£ï¼Œè¡¨ç¤ºæŒ‡å®šçš„æ³¨è§£åªåœ¨ç¼–è¯‘æœŸå¯è§ï¼Œå¹¶ä¸ä¼šå†™å…¥å­—èŠ‚ç æ–‡ä»¶ï¼ŒOverride, SuppressWarnings å°±å±äºæ­¤ç±»å‹ï¼Œè¿™ç±»æ³¨è§£å¯¹äºç¨‹åºå‘˜æ¥è¯´ä¸»è¦èµ·åˆ°åœ¨ç¼–è¯‘æ—¶æé†’çš„ä½œç”¨ï¼Œåœ¨è¿è¡Œä¿å­˜æ„ä¹‰å¹¶ä¸å¤§ï¼Œæ‰€ä»¥æœ€ç»ˆå¹¶ä¸ä¼šè¢«ç¼–è¯‘å…¥å­—èŠ‚ç æ–‡ä»¶ä¸­
    * RetentionPolicy.RUNTIME  è¡¨ç¤ºæ³¨è§£ä¼šè¢«ç¼–è¯‘å…¥æœ€ç»ˆçš„å­—ç¬¦ç æ–‡ä»¶ä¸­ï¼ŒJVM å¯åŠ¨åä¹Ÿä¼šè¯»å…¥æ³¨è§£ï¼Œè¿™æ ·æˆ‘ä»¬åœ¨è¿è¡Œæ—¶å°±å¯ä»¥é€šè¿‡åå°„æ¥è·å–è¿™äº›æ³¨è§£ï¼Œæ ¹æ®è¿™äº›æ³¨è§£æ¥åšç›¸å…³çš„æ“ä½œï¼Œ**è¿™æ˜¯å¤šæ•°è‡ªå®šä¹‰æ³¨è§£ä½¿ç”¨çš„ä¿å­˜ç­–ç•¥**ï¼Œè¿™é‡Œå¯èƒ½å¤§å®¶æœ‰ä¸ªç–‘é—®ï¼Œä¸ºå•¥ Deprecated è¢«æ ‡ä¸º RUNTIME å‘¢ï¼Œå¯¹äºç¨‹åºå‘˜æ¥è¯´ï¼Œç†è®ºä¸Šæ¥è¯´åªå…³å¿ƒè°ƒç”¨çš„ç±»ï¼Œæ–¹æ³•ç­‰æ˜¯å¦ Deprecated å°±å¤Ÿäº†ï¼Œè¿è¡Œæ—¶è·å–æœ‰å•¥æ„ä¹‰å‘¢ï¼Œè€ƒè™‘è¿™æ ·ä¸€ç§åœºæ™¯ï¼Œå‡è®¾ä½ æƒ³åœ¨ç”Ÿäº§ä¸Šç»Ÿè®¡è¿‡æ—¶çš„æ–¹æ³•è¢«è°ƒç”¨çš„é¢‘ç‡ä»¥è¯„ä¼°ä½ å·¥ç¨‹çš„åå‘³é“æˆ–ä½œä¸ºé‡æ„å‚è€ƒï¼Œæ­¤æ—¶è¿™ä¸ªæ³¨è§£æ˜¯ä¸æ˜¯æ´¾ä¸Šç”¨åœºäº†ã€‚
    * RetentionPolicy.CLASS æ³¨è§£ä¼šè¢«ç¼–è¯‘å…¥æœ€ç»ˆçš„å­—ç¬¦ç æ–‡ä»¶ï¼Œä½†å¹¶ä¸ä¼šè½½å…¥ JVM ä¸­ï¼ˆåœ¨ç±»åŠ è½½çš„æ—¶å€™æ³¨è§£ä¼šè¢«ä¸¢å¼ƒï¼‰ï¼Œè¿™ç§ä¿å­˜ç­–ç•¥ä¸å¸¸ç”¨ï¼Œä¸»è¦ç”¨åœ¨å­—èŠ‚ç æ–‡ä»¶çš„å¤„ç†ä¸­ã€‚

* @Target è¡¨ç¤ºè¯¥æ³¨è§£å¯ä»¥ç”¨åœ¨ä»€ä¹ˆåœ°æ–¹ï¼Œé»˜è®¤æƒ…å†µä¸‹å¯ä»¥ç”¨åœ¨ä»»ä½•åœ°æ–¹ï¼Œè¯¥æ³¨è§£çš„ä½œç”¨åŸŸä¸»è¦é€šè¿‡ value æ¥æŒ‡å®šï¼Œè¿™é‡Œåˆ—ä¸¾å‡ ä¸ªæ¯”è¾ƒå¸¸è§çš„ç±»å‹ï¼š
    * FIELD ä½œç”¨äºå±æ€§
    * METHOD ä½œç”¨äºæ–¹æ³•
    *   ElementType.TYPE: ä½œç”¨äºç±»ã€æ¥å£(åŒ…æ‹¬æ³¨è§£ç±»å‹) æˆ– enum å£°æ˜
* @Inherited - æ ‡è®°è¿™ä¸ªæ³¨è§£æ˜¯ç»§æ‰¿äºå“ªä¸ªæ³¨è§£ç±»(é»˜è®¤ æ³¨è§£å¹¶æ²¡æœ‰ç»§æ‰¿äºä»»ä½•å­ç±»)

å†æ¥çœ‹ @interfaceï¼Œ è¿™ä¸ªæ˜¯å¹²å•¥ç”¨çš„ï¼Œå…¶å®å¦‚æœä½ åç¼–è¯‘ä¹‹åå°±ä¼šå‘ç°åœ¨å­—èŠ‚ç ä¸­ç¼–è¯‘å™¨å°†å…¶ç¼–ç æˆäº†å¦‚ä¸‹å†…å®¹ã€‚

```java
public interface Override extends Annotation {   
}
```

Annotation æ˜¯å•¥

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img-blog.csdnimg.cn/20200828235839651.png#pic_center)


æˆ‘ä»¬å¯ä»¥çœ‹å‡º**æ³¨è§£çš„æœ¬è´¨å…¶å®æ˜¯ç»§æ‰¿äº† Annotation è¿™ä¸ªæ¥å£çš„æ¥å£**ï¼Œå¹¶ä¸”è¾…ä»¥ Retentionï¼ŒTarget è¿™äº›è§„èŒƒæ³¨è§£è¿è¡Œæ—¶è¡Œä¸ºï¼Œä½œç”¨åŸŸç­‰çš„å…ƒæ³¨è§£ã€‚

Deprecated æ³¨è§£ä¸­æ²¡æœ‰å®šä¹‰å±æ€§ï¼Œå…¶å®å¦‚æœéœ€è¦æ³¨è§£æ˜¯å¯ä»¥å®šä¹‰å±æ€§çš„ï¼Œæ¯”å¦‚ Deprecated æ³¨è§£å¯ä»¥å®šä¹‰ä¸€ä¸ª value çš„å±æ€§ï¼Œåœ¨å£°æ˜æ³¨è§£çš„æ—¶å€™å¯ä»¥æŒ‡å®šæ­¤æ³¨è§£çš„ value å€¼

```java
@Documented
@Retention(RetentionPolicy.RUNTIME)
@Target(value={CONSTRUCTOR, FIELD, LOCAL_VARIABLE, METHOD, PACKAGE, PARAMETER, TYPE})
public @interface Deprecated {
    String value() default "";
}
```

è¿™æ ·æˆ‘å°†æ­¤æ³¨è§£åº”ç”¨äºå±æ€§ç­‰åœ°æ–¹æ—¶ï¼Œå¯ä»¥æŒ‡å®šæ­¤ value  å€¼ï¼Œå¦‚ä¸‹æ‰€ç¤º

```java
public class Person {
    @Deprecated(value = "xxx")
    private String tail;
}
```

å¦‚æœæ³¨è§£çš„ä¿å­˜ç­–ç•¥ä¸º RetentionPolicy.RUNTIMEï¼Œæˆ‘ä»¬å°±å¯ä»¥ç”¨å¦‚ä¸‹æ–¹å¼åœ¨è¿è¡Œæ—¶è·å–æ³¨è§£ï¼Œè¿›è€Œè·å–æ³¨è§£çš„å±æ€§å€¼ç­‰

```java
field.getAnnotation(Deprecated.class);
```


## å·§ç”¨æ³¨è§£è§£å†³æ—¥å¿—è„±æ•ä¸æ—¥å¿—ç˜¦èº«é—®é¢˜

ä¸Šæ–‡ç®€è¿°äº†æ³¨è§£çš„åŸç†ä¸å†™æ³•ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬æ¥çœ‹çœ‹å¦‚ä½•ç”¨æ³¨è§£æ¥å®ç°æˆ‘ä»¬çš„æ—¥å¿—è„±æ•ã€‚

é¦–å…ˆæˆ‘ä»¬è¦å®šä¹‰ä¸€ä¸‹è„±æ•çš„æ³¨è§£ï¼Œç”±äºæ­¤æ³¨è§£éœ€è¦åœ¨è¿è¡Œæ—¶è¢«å–åˆ°ï¼Œæ‰€ä»¥ä¿å­˜ç­–ç•¥è¦ä¸º **RetentionPolicy.RUNTIME**ï¼Œå¦å¤–æ­¤æ³¨è§£è¦åº”ç”¨äº phoneï¼Œidcard è¿™äº›å­—æ®µï¼Œæ‰€ä»¥@Target çš„å€¼ä¸º ElementType.FIELDï¼Œå¦å¤–æˆ‘ä»¬æ³¨æ„åˆ°ï¼Œåƒç”µè¯å·ç ï¼Œèº«ä»½è¯è¿™äº›å­—æ®µè™½ç„¶éƒ½è¦è„±æ•ï¼Œä½†æ˜¯å®ƒä»¬çš„è„±æ•ç­–ç•¥ä¸ä¸€æ ·ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¸ºæ­¤æ³¨è§£å®šä¹‰ä¸€ä¸ªå±æ€§ï¼Œè¿™æ ·å¯ä»¥æŒ‡å®šå®ƒçš„å±æ€§å±äºå“ªç§è„±æ•ç±»å‹ï¼Œæˆ‘ä»¬å®šä¹‰çš„è„±æ•æ³¨è§£å¦‚ä¸‹ï¼š

```java
// æ•æ„Ÿä¿¡æ¯ç±»å‹
public enum SensitiveType {
    ID_CARD, PHONE, NAME, IMG_BASE64
}

@Target({ ElementType.FIELD })
@Retention(RetentionPolicy.RUNTIME)
public @interface SensitiveInfo {
    SensitiveType type();
}
```

å®šä¹‰å¥½äº†æ³¨è§£ï¼Œç°åœ¨å°±å¯ä»¥ä¸ºæˆ‘ä»¬çš„æ•æ„Ÿå­—æ®µæŒ‡å®šæ³¨è§£åŠå…¶æ•æ„Ÿä¿¡æ¯ç±»å‹äº†ï¼Œå¦‚ä¸‹

```java
public class Request {
    @SensitiveInfo(type = SensitiveType.NAME)
    private String name;
    @SensitiveInfo(type = SensitiveType.ID_CARD)
    private String idcard;
    @SensitiveInfo(type = SensitiveType.PHONE)
    private String phone;
    @SensitiveInfo(type = SensitiveType.IMG_BASE64)
    private String imgBase64;
}
```

ä¸ºå±æ€§æŒ‡å®šå¥½äº†æ³¨è§£ï¼Œè¯¥æ€ä¹ˆæ ¹æ®æ³¨è§£æ¥å®ç°ç›¸åº”æ•æ„Ÿå­—æ®µç±»å‹çš„è„±æ•å‘¢ï¼Œå¯ä»¥ç”¨åå°„ï¼Œå…ˆç”¨åå°„è·å–ç±»çš„æ¯ä¸€ä¸ª Field,å†åˆ¤å®š Field ä¸Šæ˜¯å¦æœ‰ç›¸åº”çš„æ³¨è§£ï¼Œè‹¥æœ‰ï¼Œå†åˆ¤æ–­æ­¤æ³¨è§£æ˜¯é’ˆå¯¹å“ªç§æ•æ„Ÿç±»å‹çš„æ³¨è§£ï¼Œå†é’ˆå¯¹ç›¸åº”å­—æ®µåšç›¸åº”çš„è„±æ•æ“ä½œï¼Œç›´æ¥ä¸Šä»£ç ï¼Œæ³¨é‡Šå†™å¾—å¾ˆæ¸…æ¥šäº†ï¼Œç›¸ä¿¡å¤§å®¶åº”è¯¥èƒ½çœ‹æ‡‚

```java
private static ValueFilter getValueFilter() {
        return (obj, key, value) -> {
            // obj-å¯¹è±¡ key-å­—æ®µå value-å­—æ®µå€¼
            try {
                // é€šè¿‡åå°„è·å–è·å–æ¯ä¸ªç±»çš„å±æ€§
                Field[] fields = obj.getClass().getDeclaredFields();
                for (Field field : fields) {
                    if (!field.getName().equals(key)) {
                        continue;
                    }
                    // åˆ¤å®šå±æ€§æ˜¯å¦æœ‰ç›¸åº”çš„ SensitiveInfo æ³¨è§£
                    SensitiveInfo annotation = field.getAnnotation(SensitiveInfo.class);
                    // è‹¥æœ‰ï¼Œåˆ™æ‰§è¡Œç›¸åº”å­—æ®µçš„è„±æ•æ–¹æ³•
                    if (null != annotation) {
                        switch (annotation.type()) {
                            case PHONE:
                                return ç”µè¯è„±æ•;
                            case ID_CARD:
                                return èº«ä»½è¯è„±æ•;
                            case NAME:
                                return å§“åè„±æ•;
                            case IMG_BASE64:
                                return ""; // å›¾ç‰‡çš„ base 64 ä¸å±•ç¤ºï¼Œç›´æ¥è¿”å›ç©º
                            default:
                                // è¿™é‡Œå¯ä»¥æŠ›å¼‚å¸¸
                        }
                    }
                    }
                }
            } catch (Exception e) {
                log.error("To JSON String fail", e);
            }
            return value;
        };
    }
```
æœ‰äººå¯èƒ½ä¼šè¯´äº†ï¼Œä½¿ç”¨æ³¨è§£çš„æ–¹å¼æ¥å®ç°è„±æ•ä»£ç é‡ç¿»äº†ä¸€å€ä¸æ­¢ï¼Œçœ‹èµ·æ¥å¥½åƒä¸æ˜¯å¾ˆå€¼å¾—ï¼Œå…¶å®ä¸ç„¶ï¼Œä¹‹å‰çš„æ–¹å¼ï¼Œè„±æ•è§„åˆ™ä¸æŸä¸ªå­—æ®µåå¼ºè—•åˆï¼Œå¯ç»´æŠ¤æ€§ä¸å¥½ï¼Œè€Œç”¨æ³¨è§£çš„æ–¹å¼ï¼Œå°±åƒå·¥ç¨‹ä¸­å‡ºç°çš„ phone, telï¼Œtelephone è¿™äº›éƒ½å±äºç”µè¯è„±æ•ç±»å‹çš„ï¼Œåªè¦ç»Ÿä¸€æ ‡ä¸Š  **@SensitiveInfo(type = SensitiveType.PHONE) ** è¿™æ ·çš„æ³¨è§£å³å¯ï¼Œè€Œä¸”åç»­å¦‚æœ‰æ–°çš„è„±æ•ç±»å‹ï¼Œåªè¦é‡æ–°åŠ ä¸€ä¸ª SensitiveType çš„ç±»å‹å³å¯ï¼Œ**å¯ç»´æŠ¤æ€§ä¸æ‰©å±•æ€§å¤§å¤§å¢å¼º**ã€‚æ‰€ä»¥åœ¨è¿™ç±»åœºæ™¯ä¸­ï¼Œä½¿ç”¨æ³¨è§£æ˜¯å¼ºçƒˆæ¨èçš„ã€‚


## æ³¨è§£çš„é«˜çº§åº”ç”¨-åˆ©ç”¨æ³¨è§£æ¶ˆé™¤é‡å¤ä»£ç 

åœ¨ä¸é“¶è¡Œå¯¹æ¥çš„è¿‡ç¨‹ä¸­ï¼Œé“¶è¡Œæä¾›äº†ä¸€äº› API æ¥å£ï¼Œå¯¹å‚æ•°çš„åºåˆ—åŒ–æœ‰ç‚¹ç‰¹æ®Šï¼Œä¸ä½¿ç”¨ JSONï¼Œè€Œæ˜¯éœ€è¦æˆ‘ä»¬æŠŠå‚æ•°ä¾æ¬¡æ‹¼åœ¨ä¸€èµ·æ„æˆä¸€ä¸ªå¤§å­—ç¬¦ä¸²ã€‚

* æŒ‰ç…§é“¶è¡Œæä¾›çš„ API æ–‡æ¡£çš„é¡ºåºï¼ŒæŠŠæ‰€æœ‰å‚æ•°æ„æˆå®šé•¿çš„æ•°æ®ï¼Œç„¶åæ‹¼æ¥åœ¨ä¸€èµ·ä½œä¸ºæ•´ä¸ªå­—ç¬¦ä¸²ã€‚
* å› ä¸ºæ¯ä¸€ç§å‚æ•°éƒ½æœ‰å›ºå®šé•¿åº¦ï¼Œæœªè¾¾åˆ°é•¿åº¦æ—¶éœ€è¦åšå¡«å……å¤„ç†ï¼š
    * å­—ç¬¦ä¸²ç±»å‹çš„å‚æ•°ä¸æ»¡é•¿åº¦éƒ¨åˆ†éœ€è¦ä»¥ä¸‹åˆ’çº¿å³å¡«å……ï¼Œä¹Ÿå°±æ˜¯å­—ç¬¦ä¸²å†…å®¹é å·¦ï¼›
    * æ•°å­—ç±»å‹çš„å‚æ•°ä¸æ»¡é•¿åº¦éƒ¨åˆ†ä»¥ 0 å·¦å¡«å……ï¼Œä¹Ÿå°±æ˜¯å®é™…æ•°å­—é å³ï¼›
    * è´§å¸ç±»å‹çš„è¡¨ç¤ºéœ€è¦æŠŠé‡‘é¢å‘ä¸‹èˆå…¥ 2 ä½åˆ°åˆ†ï¼Œä»¥åˆ†ä¸ºå•ä½ï¼Œä½œä¸ºæ•°å­—ç±»å‹åŒæ ·è¿›è¡Œå·¦å¡«å……ã€‚
* å¯¹æ‰€æœ‰å‚æ•°åš MD5 æ“ä½œä½œä¸ºç­¾åï¼ˆä¸ºäº†æ–¹ä¾¿ç†è§£ï¼ŒDemo ä¸­ä¸æ¶‰åŠåŠ ç›å¤„ç†ï¼‰ã€‚
ç®€å•çœ‹ä¸¤ä¸ªé“¶è¡Œçš„æ¥å£å®šä¹‰

1ã€åˆ›å»ºç”¨æˆ·

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img-blog.csdnimg.cn/20200828235946467.png#pic_center)


2ã€æ”¯ä»˜æ¥å£
![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img-blog.csdnimg.cn/20200828235957764.png#pic_center)


å¸¸è§„çš„åšæ³•æ˜¯ä¸ºæ¯ä¸ªæ¥å£éƒ½æ ¹æ®ä¹‹å‰çš„è§„åˆ™å¡«å……å‚æ•°ï¼Œæ‹¼æ¥ï¼ŒéªŒç­¾ï¼Œä»¥ä»¥ä¸Šä¸¤ä¸ªæ¥å£ä¸ºä¾‹ï¼Œå…ˆçœ‹çœ‹å¸¸è§„åšæ³•
    
åˆ›å»ºç”¨æˆ·ä¸æ”¯ä»˜çš„è¯·æ±‚å¦‚ä¸‹ï¼š

```java
// åˆ›å»ºç”¨æˆ· POJO
@Data
public class CreateUserRequest { 
    private String name; 
    private String identity; 
    private String mobile;
    private int age;
}

// æ”¯ä»˜ POJO
@Data
public class PayRequest { 
    private long userId; 
    private BigDecimal amount;
}

public class BankService {

    //åˆ›å»ºç”¨æˆ·æ–¹æ³•
    public static String createUser(CreateUserRequest request) throws IOException {
        StringBuilder stringBuilder = new StringBuilder();
        //å­—ç¬¦ä¸²é å·¦ï¼Œå¤šä½™çš„åœ°æ–¹å¡«å……_
        stringBuilder.append(String.format("%-10s", request.getName()).replace(' ', '_'));
        //å­—ç¬¦ä¸²é å·¦ï¼Œå¤šä½™çš„åœ°æ–¹å¡«å……_
        stringBuilder.append(String.format("%-18s", request.getIdentity()).replace(' ', '_'));
        //æ•°å­—é å³ï¼Œå¤šä½™çš„åœ°æ–¹ç”¨0å¡«å……
        stringBuilder.append(String.format("%05d", age));
        //å­—ç¬¦ä¸²é å·¦ï¼Œå¤šä½™çš„åœ°æ–¹ç”¨_å¡«å……
        stringBuilder.append(String.format("%-11s", mobile).replace(' ', '_'));
        //æœ€ååŠ ä¸ŠMD5ä½œä¸ºç­¾å
        stringBuilder.append(DigestUtils.md2Hex(stringBuilder.toString()));
        return Request.Post("http://baseurl/createUser")
                .bodyString(stringBuilder.toString(), ContentType.APPLICATION_JSON)
                .execute().returnContent().asString();
    }
    
    //æ”¯ä»˜æ–¹æ³•
    public static String pay(PayRequest request) throws IOException {
        StringBuilder stringBuilder = new StringBuilder();
        //æ•°å­—é å³ï¼Œå¤šä½™çš„åœ°æ–¹ç”¨0å¡«å……
        stringBuilder.append(String.format("%020d", request.getUserId()));
        //é‡‘é¢å‘ä¸‹èˆå…¥2ä½åˆ°åˆ†ï¼Œä»¥åˆ†ä¸ºå•ä½ï¼Œä½œä¸ºæ•°å­—é å³ï¼Œå¤šä½™çš„åœ°æ–¹ç”¨0å¡«å……
 stringBuilder.append(String.format("%010d",request.getAmount().setScale(2,RoundingMode.DOWN).multiply(new                                                                                  BigDecimal("100")).longValue())); 
        //æœ€ååŠ ä¸ŠMD5ä½œä¸ºç­¾å
        stringBuilder.append(DigestUtils.md2Hex(stringBuilder.toString()));
        return Request.Post("http://baseurl//pay")
                .bodyString(stringBuilder.toString(), ContentType.APPLICATION_JSON)
                .execute().returnContent().asString();
    }
}
```

å¯ä»¥çœ‹åˆ°å…‰å†™è¿™ä¸¤ä¸ªè¯·æ±‚ï¼Œé€»è¾‘å°±æœ‰å¾ˆå¤šé‡å¤çš„åœ°æ–¹ï¼š

1ã€ å­—ç¬¦ä¸²ï¼Œè´§å¸ï¼Œæ•°å­—ä¸‰ç§ç±»å‹çš„æ ¼å¼åŒ–é€»è¾‘å¤§é‡é‡å¤ï¼Œä»¥å¤„ç†å­—ç¬¦ä¸²ä¸ºä¾‹

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img-blog.csdnimg.cn/20200829000056937.png#pic_center)


å¯ä»¥çœ‹åˆ°ï¼Œæ ¼å¼åŒ–å­—ç¬¦ä¸²çš„çš„å¤„ç†åªæ˜¯æ¯ä¸ªå­—æ®µçš„é•¿åº¦ä¸åŒï¼Œå…¶ä½™æ ¼å¼åŒ–è§„åˆ™å®Œå…¨ä¸€æ ·ï¼Œä½†åœ¨ä¸Šæ–‡ä¸­æˆ‘ä»¬å´ä¸ºæ¯ä¸€ä¸ªå­—ç¬¦ä¸²éƒ½æ•´äº†ä¸€å¥—ç›¸åŒçš„å¤„ç†é€»è¾‘ï¼Œè¿™å¥—æ‹¼æ¥è§„åˆ™å®Œå…¨å¯ä»¥æŠ½å‡ºæ¥ï¼ˆå› ä¸ºåªæ˜¯é•¿åº¦ä¸ä¸€æ ·ï¼Œæ‹¼æ¥è§„åˆ™æ˜¯ä¸€æ ·çš„ï¼‰

2ã€ å¤„ç†æµç¨‹ä¸­å­—ç¬¦ä¸²æ‹¼æ¥ã€åŠ ç­¾å’Œå‘è¯·æ±‚çš„é€»è¾‘ï¼Œåœ¨æ‰€æœ‰æ–¹æ³•é‡å¤ã€‚

3ã€ ç”±äºæ¯ä¸ªå­—æ®µå‚ä¸æ‹¼æ¥çš„é¡ºåºä¸ä¸€æ ·ï¼Œè¿™äº›éœ€è¦æˆ‘ä»¬äººè‚‰ç¡¬ç¼–ç ä¿è¯è¿™äº›å­—æ®µçš„é¡ºåºï¼Œç»´æŠ¤æˆæœ¬æå¤§ï¼Œè€Œä¸”å¾ˆå®¹æ˜“å‡ºé”™ï¼Œæƒ³è±¡ä¸€ä¸‹å¦‚æœå‚æ•°è¾¾åˆ°å‡ åä¸Šç™¾ä¸ªï¼Œè¿™äº›å‚æ•°éƒ½éœ€è¦æŒ‰ä¸€å®šé¡ºåºæ¥æ‹¼æ¥ï¼Œå¦‚æœè¦äººè‚‰æ¥ä¿è¯ï¼Œå¾ˆéš¾ä¿è¯æ­£ç¡®æ€§ï¼Œè€Œä¸”é‡å¤å·¥ä½œå¤ªå¤šï¼Œå¾—ä¸å¿å¤±


æ¥ä¸‹æ¥æˆ‘ä»¬æ¥çœ‹çœ‹å¦‚ä½•ç”¨æ³¨è§£æ¥æå¤§ç®€åŒ–æˆ‘ä»¬çš„ä»£ç ã€‚

1ã€ é¦–å…ˆå¯¹äºæ¯ä¸€ä¸ªè°ƒç”¨æ¥å£æ¥è¯´ï¼Œå®ƒä»¬åº•å±‚éƒ½æ˜¯éœ€è¦è¯·æ±‚ç½‘ç»œçš„ï¼Œåªæ˜¯è¯·æ±‚æ–¹æ³•ä¸ä¸€æ ·ï¼Œé’ˆå¯¹è¿™ä¸€ç‚¹ ï¼Œæˆ‘ä»¬å¯ä»¥æä¸€ä¸ªå¦‚ä¸‹é’ˆå¯¹æ¥å£çš„æ³¨è§£

```java
@Retention(RetentionPolicy.RUNTIME)
@Target(ElementType.TYPE)
@Documented
@Inherited
public @interface BankAPI { 
    String url() default "";
    String desc() default ""; 
}
```
è¿™æ ·åœ¨ç½‘ç»œè¯·æ±‚å±‚å³å¯ç»Ÿä¸€é€šè¿‡æ³¨è§£è·å–ç›¸åº”æ¥å£çš„æ–¹æ³•å

2ã€ é’ˆå¯¹æ¯ä¸ªè¯·æ±‚æ¥å£çš„ POJO,æˆ‘ä»¬æ³¨æ„åˆ°æ¯ä¸ªå±æ€§éƒ½æœ‰ **ç±»å‹ï¼ˆå­—ç¬¦ä¸²/æ•°å­—/è´§å¸ï¼‰**ï¼Œ**é•¿åº¦**ï¼Œ**é¡ºåº**è¿™ä¸‰ä¸ªå±æ€§ï¼Œæ‰€ä»¥å¯ä»¥å®šä¹‰ä¸€ä¸ªæ³¨è§£ï¼ŒåŒ…å«è¿™ä¸‰ä¸ªå±æ€§ï¼Œå¦‚ä¸‹

```java
@Retention(RetentionPolicy.RUNTIME)
@Target(ElementType.FIELD)
@Documented
@Inherited
public @interface BankAPIField {
    int order() default -1;
    int length() default -1;
    String type() default ""; // Mä»£è¡¨è´§å¸ï¼ŒSä»£è¡¨å­—ç¬¦ä¸²ï¼ŒNä»£è¡¨æ•°å­—
}
```

æ¥ä¸‹æ¥æˆ‘ä»¬å°†ä¸Šæ–‡ä¸­å®šä¹‰çš„æ³¨è§£åº”ç”¨åˆ°ä¸Šæ–‡ä¸­çš„è¯·æ±‚ POJO ä¸­

å¯¹äºåˆ›å»ºç”¨æˆ·è¯·æ±‚

```java
@BankAPI(url = "/createUser", desc = "åˆ›å»ºç”¨æˆ·æ¥å£")
@Data
public class CreateUserAPI extends AbstractAPI {
    @BankAPIField(order = 1, type = "S", length = 10)
    private String name;
    @BankAPIField(order = 2, type = "S", length = 18)
    private String identity;
    @BankAPIField(order = 4, type = "S", length = 11) //æ³¨æ„è¿™é‡Œçš„orderéœ€è¦æŒ‰ç…§APIè¡¨æ ¼ä¸­çš„é¡ºåº
    private String mobile;
    @BankAPIField(order = 3, type = "N", length = 5)
    private int age;
}
```

å¯¹äºæ”¯ä»˜æ¥å£

```java
@BankAPI(url = "/bank/pay", desc = "æ”¯ä»˜æ¥å£")
@Data
public class PayAPI extends AbstractAPI {
    @BankAPIField(order = 1, type = "N", length = 20)
    private long userId;
    @BankAPIField(order = 2, type = "M", length = 10)
    private BigDecimal amount;
}
```

æ¥ä¸‹æ¥åˆ©ç”¨æ³¨è§£æ¥è°ƒç”¨çš„æµç¨‹å¦‚ä¸‹

1. æ ¹æ®åå°„è·å–ç±»çš„ Field æ•°ç»„ï¼Œç„¶åå†æ ¹æ® Field çš„ BankAPIField æ³¨è§£ä¸­çš„ order å€¼å¯¹ Field è¿›è¡Œæ’åº
2. å¯¹æ’åºåçš„ Field ä»Šæ¬¡è¿›è¡Œéå†ï¼Œé¦–å…ˆåˆ¤æ–­å…¶ç±»å‹ï¼Œç„¶åå†å¯¹å…¶è¿›è¡Œå€¼çš„çš„æ ¼å¼åŒ–ï¼Œå¦‚åˆ¤æ–­ä¸º"S",åˆ™æŒ‰æ¥å£è¦æ±‚å­—ç¬¦ä¸²çš„æ ¼å¼å¯¹å…¶å€¼è¿›è¡Œæ ¼å¼åŒ–ï¼Œå°†è¿™äº›æ ¼å¼åŒ–åçš„ Field å€¼ä¾æ¬¡æ‹¼æ¥èµ·æ¥å¹¶è¿›è¡Œç­¾å
3. æ‹¼æ¥åå°±æ˜¯å‘è¯·æ±‚äº†ï¼Œæ­¤æ—¶å†æ‹¿åˆ° POJO ç±»çš„æ³¨è§£ï¼Œè·å–æ³¨è§£ BankAPI  çš„ url å€¼ï¼Œå°†å…¶ä¸ baseUrl ç»„åˆèµ·æ¥å³å¯æ„æˆä¸€ä¸ªå®Œæ•´çš„çš„ urlï¼Œå†åŠ ä¸Šç¬¬ 2 æ­¥ä¸­æ‹¼æ¥å­—ç¬¦ä¸²å³å¯æ„é€ ä¸€ä¸ªå®Œå…¨çš„è¯·æ±‚

ä»£ç å¦‚ä¸‹ï¼š

```java

private static String remoteCall(AbstractAPI api) throws IOException {
    //ä»BankAPIæ³¨è§£è·å–è¯·æ±‚åœ°å€
    BankAPI bankAPI = api.getClass().getAnnotation(BankAPI.class);
    bankAPI.url();
    StringBuilder stringBuilder = new StringBuilder();
    Arrays.stream(api.getClass().getDeclaredFields()) //è·å¾—æ‰€æœ‰å­—æ®µ
            .filter(field -> field.isAnnotationPresent(BankAPIField.class)) //æŸ¥æ‰¾æ ‡è®°äº†æ³¨è§£çš„å­—æ®µ
            .sorted(Comparator.comparingInt(a -> a.getAnnotation(BankAPIField.class).order())) //æ ¹æ®æ³¨è§£ä¸­çš„orderå¯¹å­—æ®µæ’åº
            .peek(field -> field.setAccessible(true)) //è®¾ç½®å¯ä»¥è®¿é—®ç§æœ‰å­—æ®µ
            .forEach(field -> {
                //è·å¾—æ³¨è§£
                BankAPIField bankAPIField = field.getAnnotation(BankAPIField.class);
                Object value = "";
                try {
                    //åå°„è·å–å­—æ®µå€¼
                    value = field.get(api);
                } catch (IllegalAccessException e) {
                    e.printStackTrace();
                }
                //æ ¹æ®å­—æ®µç±»å‹ä»¥æ­£ç¡®çš„å¡«å……æ–¹å¼æ ¼å¼åŒ–å­—ç¬¦ä¸²
                switch (bankAPIField.type()) {
                    case "S": {
                        stringBuilder.append(String.format("%-" + bankAPIField.length() + "s", value.toString()).replace(' ', '_'));
                        break;
                    }
                    case "N": {
                        stringBuilder.append(String.format("%" + bankAPIField.length() + "s", value.toString()).replace(' ', '0'));
                        break;
                    }
                    case "M": {
                        if (!(value instanceof BigDecimal))
                            throw new RuntimeException(String.format("{} çš„ {} å¿…é¡»æ˜¯BigDecimal", api, field));
                        stringBuilder.append(String.format("%0" + bankAPIField.length() + "d", ((BigDecimal) value).setScale(2, RoundingMode.DOWN).multiply(new BigDecimal("100")).longValue()));
                        break;
                    }
                    default:
                        break;
                }
            });
    //ç­¾åé€»è¾‘
   stringBuilder.append(DigestUtils.md2Hex(stringBuilder.toString()));
    String param = stringBuilder.toString();
    long begin = System.currentTimeMillis();
    //å‘è¯·æ±‚
    String result = Request.Post("http://localhost:45678/reflection" + bankAPI.url())
            .bodyString(param, ContentType.APPLICATION_JSON)
            .execute().returnContent().asString();
    log.info("è°ƒç”¨é“¶è¡ŒAPI {} url:{} å‚æ•°:{} è€—æ—¶:{}ms", bankAPI.desc(), bankAPI.url(), param, System.currentTimeMillis() - begin);
    return result;
}
```

ç°åœ¨å†æ¥çœ‹ä¸€ä¸‹åˆ›å»ºç”¨æˆ·å’Œä»˜æ¬¾çš„é€»è¾‘

```java

//åˆ›å»ºç”¨æˆ·æ–¹æ³•
public static String createUser(CreateUserAPI request) throws IOException {
    return remoteCall(request);
}
//æ”¯ä»˜æ–¹æ³•
public static String pay(PayAPI request) throws IOException {
    return remoteCall(request);
}
```

å¯ä»¥çœ‹åˆ°æ‰€æœ‰çš„è¯·æ±‚ç°åœ¨éƒ½åªè¦ç»Ÿä¸€è°ƒç”¨  remoteCall è¿™ä¸ªæ–¹æ³•å³å¯ï¼ŒremoteCall è¿™ä¸ªæ–¹æ³•ç»Ÿä¸€äº†æ‰€æœ‰è¯·æ±‚çš„é€»è¾‘ï¼Œçœç•¥äº†å·¨é‡æ— å…³çš„ä»£ç ï¼Œè®©ä»£ç çš„å¯ç»´æŠ¤æ€§å¤§å¤§å¢å¼ºï¼**ä½¿ç”¨æ³¨è§£å’Œåå°„è®©æˆ‘ä»¬å¯ä»¥å¯¹è¿™ç±»ç»“æ„æ€§çš„é—®é¢˜è¿›è¡Œé€šç”¨åŒ–å¤„ç†**ï¼Œç¡®å® Cool!

## æ€»ç»“
å¦‚æœè¯´åå°„ç»™äº†æˆ‘ä»¬åœ¨ä¸çŸ¥æ™“ç±»ç»“æ„çš„æƒ…å†µä¸‹æŒ‰ç…§å›ºå®šé€»è¾‘å¤„ç†ç±»æˆå‘˜çš„èƒ½åŠ›çš„è¯ï¼Œæ³¨è§£åˆ™æ˜¯æ‰©å±•è¡¥å……äº†è¿™äº›æˆå‘˜çš„å…ƒæ•°æ®çš„èƒ½åŠ›ï¼Œä½¿ç”¨å¾—æˆ‘ä»¬åœ¨åˆ©ç”¨åå°„å®ç°é€šç”¨é€»è¾‘çš„æ—¶å€™ï¼Œå¯ä»¥ä»å¤–éƒ¨è·å–æ›´å¤šæˆ‘ä»¬å…³å¿ƒçš„æ•°æ®ï¼Œè¿›è€Œå¯¹è¿™äº›æ•°æ®è¿›è¡Œé€šç”¨çš„å¤„ç†ï¼Œå·§ç”¨åå°„ï¼Œç¡®å®èƒ½è®©æˆ‘ä»¬è¾¾åˆ°äº‹åŠåŠŸå€çš„æ•ˆæœï¼Œèƒ½æå¤§çš„å‡å°‘é‡å¤ä»£ç ï¼Œæœ‰æ•ˆè§£è—•ï¼Œä½¿æ‰©å±•æ€§å¤§å¤§æå‡ã€‚

é¢å¤–æä¸€å¥ï¼Œä¸Šæ–‡ä¸­æ³¨è§£çš„é«˜çº§åº”ç”¨çš„ä¾‹å­æ¥è‡ªæ–‡æœ«çš„å‚è€ƒé“¾æ¥ä¸­çš„ä¸€ä¸ªä¾‹å­ï¼Œæ–‡ç« éå¸¸æ£’ï¼å¦‚æœå¤§å®¶æ²¡æœ‰è®¢é˜…æ•™ç¨‹ï¼Œå¯ä»¥åŠ æˆ‘å¥½å‹ï¼ˆgeekoftasteï¼‰ï¼Œé‚€è¯·ä½ è¯•è¯»

å·¨äººçš„è‚©è†€

https://time.geekbang.org/column/article/228964


æ¬¢è¿å…³æ³¨å…¬ä¼—å·åŠ æˆ‘ä¸ªäººå¾®ä¿¡äº¤æµå“¦

![](https://imgconvert.csdnimg.cn/aHR0cHM6Ly91c2VyLWdvbGQtY2RuLnhpdHUuaW8vMjAyMC83LzYvMTczMjQ2MWJmNjUxZmQ0ZQ?x-oss-process=image/format,png)
